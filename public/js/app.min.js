"use strict";function Student(s,e){this.studentName=s,this.totalScore=e||0}function Score(s,e){this.scoreName=s,this.score=e||0}function Assignment(s,e){this.assignmentName=s,this.points=e}function renderAll(){alphabetizeStudents(),renderStudents(),renderAssignments()}function properCapitalization(s){var e=/(\b[a-z](?!\s))/g,t=s.replace(/\s/g,"-");return t.replace(e,function(s){return s.toUpperCase()})}function renderStudents(){$("tr").find(".student").parent().remove();for(var s=0;s<myClass.students.length;s++)myClass.students[s].getPercentScore(),myClass.students[s].getLetterGrade(),$("#table").append('<tr><td class="editable student students" id="'+myClass.students[s].studentName+'">'+myClass.students[s].studentName+'</td> <td class="grade grades" id="letterGrade'+myClass.students[s].studentName+'">'+myClass.students[s].letterGrade+'</td> <td class ="grade grades" id="percentGrade'+myClass.students[s].studentName+'">'+myClass.students[s].percentGrade+" %</td></tr>")}function renderAssignments(){var s,e,t,n,a,o,i;for($(".assignment").remove(),a=0;a<myClass.assignments.length;a++){for(o=0;o<myClass.students.length;o++){if(void 0!==myClass.scores[0])for(i=0;i<myClass.scores.length;i++){if(s=!1,myClass.scores[i].scoreName.slice(0,-myClass.assignments[a].assignmentName.length)===myClass.students[o].studentName&&myClass.scores[i].scoreName.slice(myClass.students[o].studentName.length)===myClass.assignments[a].assignmentName){void 0!==myClass.scores[0]&&(n=myClass.scores[i].score),t=myClass.students[o].studentName,e=t+myClass.assignments[a].assignmentName,$("#percentGrade"+t).after('<td class="editable score" id="'+e+'">'+n+"</td>"),s=!0;break}s=!1}else s=!1;s||(n="",t=myClass.students[o].studentName,e=t+myClass.assignments[a].assignmentName,$("#percentGrade"+t).after('<td class="editable score" id="'+e+'">'+n+"</td>"))}$("#gradePercent").after('<th class="editable assignment" id='+myClass.assignments[a].assignmentName+">"+myClass.assignments[a].assignmentName+'<br><table><tr><td class="editable assignmentPoints" id="points'+myClass.assignments[a].assignmentName+'">'+myClass.assignments[a].points+" pts</td></tr></table></th>")}}function alphabetizeStudents(){var s,e,t,n;if(myClass.students.length>1)for(;;){for(e=0,s=0;s<myClass.students.length-1;s++)myClass.students[s+1].studentName<myClass.students[s].studentName&&(t=myClass.students[s],n=myClass.students[s+1],myClass.students[s]=n,myClass.students[s+1]=t,e++);if(0===e)break}}function editCells(s,e,t){var n,a=!1;$(".clicked").text(""),$("<input>").attr({type:"text",id:"editing"}).appendTo(".clicked"),$("#editing").focus(),$("#editing").on("blur",function(){var o=properCapitalization($("#editing").val());if(" "===o&&(o=""),o.length>0){if($(".clicked").text(o),$(".clicked").is($(".assignment")))$(".clicked").attr("id",o),myClass.assignments.forEach(function(s,e,t){s.assignmentName===o&&console.log("that was already in the list! So we're not changing anything!")}),a===!1&&myClass.assignments.forEach(function(s,t,n){s.assignmentName===e&&(myClass.assignments[t].assignmentName=o)}),mongo.assignments.put({assignmentArray:myClass.assignments}),myClass.scores.forEach(function(s,t,n){s.scoreName.slice(-e.length)===e&&(s.scoreName=s.scoreName.slice(0,s.scoreName.length-e.length)+o)}),mongo.scores.put({scoreArray:myClass.scores}),xs,$(".clicked").removeClass("clicked");else if($(".clicked").is($(".student")))$(".clicked").attr("id",o),myClass.students.forEach(function(s,e,t){s.studentName===o&&(console.log("that was already in the list! So we're not changing anything!"),a=!0)}),a===!1&&(myClass.students.forEach(function(e,t,n){e.studentName===s&&(myClass.students[t].studentName=o)}),mongo.students.put({studentArray:myClass.students}),myClass.scores.forEach(function(e,t,n){e.scoreName.slice(0,s.length)===s&&(e.scoreName=o+e.scoreName.slice(s.length))}),mongo.scores.put({scoreArray:myClass.scores})),$(".clicked").attr("class","editable student");else if($(".clicked").is($(".score"))){myClass.students.forEach(function(e,n,a){e.studentName===s&&e.removePoints(t)}),n=Number($(this).val())>=0?Number($(this).val()):0;myClass.students.forEach(function(e,t,a){e.studentName===s&&e.addPoints(n)}),$(".clicked").is($("#"+s+e))&&myClass.scores.forEach(function(s,e,t){s.scoreName===$(".clicked").attr("id")&&(s.updateScore(n),n=0)}),mongo.scores.put({scoreArray:myClass.scores}),mongo.students.put({studentArray:myClass.students}),$(".clicked").attr("class","editable score")}$("#editing").remove(),renderAll()}else renderAll()})}function deleteObject(s,e){var t,n=!1;"student"===e&&(myClass.students.forEach(function(e,t,a){e.studentName===s&&(n=!0,myClass.students.splice(e,1))}),mongo.students.put({studentArray:myClass.students})),"assignment"===e&&myClass.assignments.forEach(function(e,a,o){e.assignmentName===s&&(n=!0,myClass.points-=e.points,t=e.points,myClass.assignments.splice(e,1),mongo.points.put({totalPoints:myClass.points}),mongo.assignments.put({assignmentArray:myClass.assignments}),myClass.students.forEach(function(s,e,n){s.removePoints(t)}),mongo.students.put({studentArray:myClass.students}))}),n||console.log("couldn't find it, so I can't delete it!")}var mongo=function(){var s=[],e={put:function(s){$.ajax({url:"https://api.mongolab.com/api/1/databases/gradebookproject/collections/myData/"+this.mongoID+"?apiKey=Q_MWxLPLxfonVusuXCHtaz6boo4vCKTN",data:JSON.stringify({$set:s}),type:"PUT",contentType:"application/json",success:console.log("Connected to mongoDB using mongo."+this.name+".put()")})},get:function(){$.ajax({url:"https://api.mongolab.com/api/1/databases/gradebookproject/collections/myData/"+this.mongoID+"?apiKey=Q_MWxLPLxfonVusuXCHtaz6boo4vCKTN",type:"GET",contentType:"application/json",dataType:"json",success:function(){console.log("Connected to mongoDB using mongo."+this.name+".get()")}.bind(this)}).done(function(e){return this.response=e,this===mongo.students&&(s[0]=mongo.students.response,myClass.students=mongo.students.response.studentArray||[],myClass.students.forEach(function(s,e,t){Object.setPrototypeOf(s,Student.prototype)})),this===mongo.assignments&&(s[1]=mongo.assignments.response,myClass.assignments=mongo.assignments.response.assignmentArray||[],myClass.assignments.forEach(function(s,e,t){Object.setPrototypeOf(s,Assignment.prototype)})),this===mongo.scores&&(s[2]=mongo.scores.response,myClass.scores=mongo.scores.response.scoreArray||[],myClass.scores.forEach(function(s,e,t){Object.setPrototypeOf(s,Score.prototype)})),this===mongo.points&&(s[3]=mongo.points.response,myClass.points=mongo.points.response.totalPoints||0),void 0===myClass.getCounter?myClass.getCounter=1:myClass.getCounter++,4===myClass.getCounter?renderAll():void 0}.bind(this))}},t=Object.create(e,{name:{value:"points"},mongoID:{value:"56005b32e4b0e6c040a24d34"},response:{value:null,writable:!0}}),n=Object.create(e,{name:{value:"students"},mongoID:{value:"56005b32e4b0e6c040a24d36"},response:{value:null,writable:!0}}),a=Object.create(e,{name:{value:"scores"},mongoID:{value:"56005b32e4b099d78856fee9"},response:{value:null,writable:!0}}),o=Object.create(e,{name:{value:"assignments"},mongoID:{value:"56005b32e4b0e6c040a24d35"},response:{value:null,writable:!0}});return{points:t,students:n,scores:a,assignments:o,res:s}}();!function(){mongo.students.get(),mongo.scores.get(),mongo.assignments.get(),mongo.points.get()}();var myClass=function(){var s={getCounter:null,assignments:null,students:null,scores:null,points:function(){var s=0;return this.assignments.forEach(function(e,t,n){s+=e.points}),s}};return s}();~function(){this.addPoints=function(s){return this.totalScore+=s||0},this.removePoints=function(s){return this.totalScore-=s||0},this.getPercentScore=function(){this.percentGrade=(this.totalScore/myClass.points*100).toFixed(2),0===myClass.points&&(this.percentGrade=0)},this.getLetterGrade=function(){this.percentGrade>=90?this.letterGrade="A":this.percentGrade>=80?this.letterGrade="B":this.percentGrade>=70?this.letterGrade="C":this.percentGrade>=60?this.letterGrade="D":this.percentGrade<60?this.letterGrade="F":this.letterGrade="Houston, we have a problem."},this.addStudent=function(){var s=!1,e=this.studentName;myClass.students.forEach(function(t,n,a){t.studentName===e&&(console.log("we got a match for "+e),s=!0)}),s||(myClass.students.unshift(this),mongo.students.put({studentArray:myClass.students}))}}.call(Student.prototype),Score.prototype.updateScore=function(s){return this.score=s},$("#addStudent").on("click",function(){""===$("#studentName").val()?console.log("Nothing to add! Enter a new student name!"):(new Student(properCapitalization($("#studentName").val())).addStudent(),renderAll())}),Assignment.prototype.addAssignment=function(){var s=!1,e=this.assignmentName;myClass.assignments.forEach(function(t,n,a){t.assignmentName===e&&(console.log("we got a match for "+e),s=!0)}),s||(myClass.assignments.unshift(this),console.dir(myClass.assignments),myClass.points+=this.points,mongo.assignments.put({assignmentArray:myClass.assignments}),mongo.points.put({totalPoints:myClass.points}))},$("#addAssignment").on("click",function(){var s=Number($("#pointValue").val());""!==$("#assignmentName").val()&&/^\d+$/.test(s)?(new Assignment(properCapitalization($("#assignmentName").val()),s).addAssignment(),renderAll()):console.log("make sure the fields are not blank and that the points value is a positive whole number")}),$("table").on("click",".editable",function(){var s,e,t,n=!1;$(this).is(".student")&&(s=$(this).text(),e=null,t=null),$(this).is(".assignment")&&(s=null,e=$(this).attr("id"),t=null),$(this).is(".score")&&(s=$(this).siblings(":first").attr("id"),e=$(this).attr("id").slice(s.length),t=Number($(this).text()),myClass.scores.forEach(function(t,a,o){t.scoreName===s+e&&(n=!0)}),n||(myClass.scores.push(new Score(s+e)),console.log(myClass.scores),mongo.scores.put({scoreArray:myClass.scores}))),$(this).addClass("clicked"),editCells(s,e,t)}),$("#deleteStudent").on("click",function(){""===$("#deleteStudentName").val()?console.log("nothing to delete!"):(deleteObject(properCapitalization($("#deleteStudentName").val()),"student"),renderAll())}),$("#deleteAssignment").on("click",function(){""===$("#deleteAssignmentName").val()?console.log("nothing to delete!"):(deleteObject(properCapitalization($("#deleteAssignmentName").val()),"assignment"),renderAll())});